import{_ as re,r as c,l as b,o as oe,m as ie,c as d,a as l,b as ue,n as v,g as y,p as j,d as J,e as ce,F as U,q as z,v as de,u as B,t as i,j as ve,T as me,k as m}from"./index-9vT7cwdc.js";const pe={class:"formatter"},fe={class:"formatter-actions"},he=["disabled"],ge=["disabled"],be=["disabled"],ye=["disabled"],Je={class:"formatter-content"},Oe={class:"panel-header"},Se={class:"input-actions"},Ne={class:"editor-container with-line-numbers"},ke={class:"line-numbers"},_e={key:0,class:"validation-message"},Ce={key:1,class:"json-stats"},we={class:"output-panel"},Te={class:"panel-header"},xe={class:"output-actions"},je=["disabled"],De=["disabled"],Le={class:"editor-container with-line-numbers"},Me={class:"line-numbers"},Ee=["innerHTML"],Ve={key:0,class:"output-stats"},Fe={key:0,class:"toast-container"},Re={__name:"JsonFormatter",setup($e){const n=c(""),r=c(""),f=c(""),O=c(!1),S=c(!1),N=c(!1),h=c(!1),u=c(null),D=c(null),C=c(null),p=c({show:!1,message:"",type:"success",icon:"mdi-check-circle"});let w=null;const L=b(()=>n.value?n.value.split(`
`):[]),M=b(()=>r.value?r.value.split(`
`):[]),k=b(()=>n.value?{charCount:n.value.length,lineCount:L.value.length,maxDepth:K(n.value)}:null),_=b(()=>{if(!r.value)return null;const t=n.value.length,e=r.value.length,s=t>0?Math.round((1-e/t)*100):0;return{charCount:r.value.length,lineCount:M.value.length,compressionRatio:s}}),H=b(()=>r.value?P(r.value):""),A=(t,e)=>(...s)=>{clearTimeout(w),w=setTimeout(()=>t.apply(this,s),e)},a=(t,e="success")=>{p.value.message=t,p.value.type=e,p.value.icon=e==="success"?"mdi-check-circle":"mdi-alert-circle",p.value.show=!0,setTimeout(()=>{p.value.show=!1},3e3)},g=t=>{try{return t.trim()?(JSON.parse(t),f.value="有效的 JSON 格式",O.value=!0,h.value=!1,u.value=null,!0):(f.value="",O.value=!1,h.value=!1,u.value=null,!1)}catch(e){return f.value=`无效的 JSON: ${e.message}`,O.value=!1,h.value=!0,u.value=q(t,e.message),!1}},q=(t,e)=>{try{const s=t.split(`
`);for(let o=0;o<s.length;o++)try{JSON.parse(s.slice(0,o+1).join(`
`))}catch{return o+1}}catch{}return null},K=t=>{try{const e=JSON.parse(t);return E(e)}catch{return 0}},E=(t,e=0)=>{if(t===null||typeof t!="object")return e;let s=e;for(const o in t)t.hasOwnProperty(o)&&(s=Math.max(s,E(t[o],e+1)));return s},P=t=>{let e=t.replace(/("[^"]+?")(?=\s*:)/g,'<span class="json-key">$1</span>');return e=e.replace(/(:\s*)(".*?"|-?\d+(?:\.\d+)?|true|false|null)/g,'$1<span class="json-value">$2</span>'),e},V=A(()=>{if(n.value.trim()){if(g(n.value))try{const e=JSON.parse(n.value);r.value=JSON.stringify(e,null,2)}catch{}}else f.value="",r.value="",h.value=!1,u.value=null},300),G=t=>{const e=t.target.files[0];e&&F(e),t.target.value=""},Q=()=>{var t;(t=D.value)==null||t.click()},W=t=>{t.preventDefault(),N.value=!1;const e=t.dataTransfer.files;e.length>0&&F(e[0])},F=t=>{if(t.size>10*1024*1024){a("文件过大，请选择小于 10MB 的文件","error");return}const e=new FileReader;e.onload=s=>{n.value=s.target.result,a(`已加载文件: ${t.name}`)},e.onerror=()=>{a("文件读取失败","error")},e.readAsText(t)},X=async()=>{if(!n.value.trim()){a("请先输入JSON数据","error");return}try{if(g(n.value)){const t=JSON.parse(n.value);r.value=JSON.stringify(t,null,2),a("JSON 格式化成功")}else a("JSON 格式无效，请检查输入","error")}catch(t){a(`格式化失败: ${t.message}`,"error")}},Y=async()=>{if(!n.value.trim()){a("请先输入JSON数据","error");return}try{if(g(n.value)){const t=JSON.parse(n.value);r.value=JSON.stringify(t),a("JSON 压缩成功")}else a("JSON 格式无效，请检查输入","error")}catch(t){a(`压缩失败: ${t.message}`,"error")}},Z=async()=>{if(!n.value.trim()){a("请先输入JSON数据","error");return}try{g(n.value)?a("JSON 格式有效"):a("JSON 格式无效，请检查输入","error")}catch(t){a(`验证失败: ${t.message}`,"error")}},ee=async()=>{if(!n.value.trim()){a("请先输入JSON数据","error");return}try{if(!g(n.value)){a("JSON 格式无效，无法排序","error");return}const t=JSON.parse(n.value),e=T(t);r.value=JSON.stringify(e,null,2),a("JSON 已排序")}catch(t){a(`排序失败: ${t.message}`,"error")}},T=t=>{if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s=>T(s));const e={};return Object.keys(t).sort().forEach(s=>{e[s]=T(t[s])}),e},te=async()=>{if(!r.value){a("没有可复制的内容","error");return}try{await navigator.clipboard.writeText(r.value),S.value=!0,a("已复制到剪贴板"),setTimeout(()=>{S.value=!1},2e3)}catch{a("复制失败","error")}},le=()=>{n.value="",f.value="",r.value="",h.value=!1,u.value=null,a("输入已清空")},se=async()=>{try{const t=await navigator.clipboard.readText();if(n.value=t,t.trim())if(g(t))try{const s=JSON.parse(t);r.value=JSON.stringify(s,null,2),a("JSON 已自动格式化")}catch{a("JSON 格式无效，请检查输入","error")}else a("JSON 格式无效，请检查输入","error")}catch{a("无法从剪贴板读取内容","error")}},ne=()=>{if(!r.value){a("没有可下载的内容","error");return}const t=new Blob([r.value],{type:"application/json;charset=utf-8"}),e=URL.createObjectURL(t),s=document.createElement("a");s.href=e,s.download=`formatted_json_${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e),a("JSON 文件已下载")},ae=()=>{if(u.value&&C.value){const t=C.value,e=n.value.split(`
`);let s=0;for(let x=0;x<u.value-1;x++)s+=e[x].length+1;t.setSelectionRange(s,s),t.focus();const I=(u.value-1)*20;t.scrollTop=Math.max(0,I-t.clientHeight/2)}},R=()=>{N.value=!0},$=()=>{N.value=!1};return oe(()=>{document.addEventListener("dragenter",R),document.addEventListener("dragleave",$)}),ie(()=>{document.removeEventListener("dragenter",R),document.removeEventListener("dragleave",$),clearTimeout(w)}),(t,e)=>(m(),d("div",pe,[e[16]||(e[16]=l("div",{class:"formatter-header"},[l("h1",null,"JSON 格式化工具"),l("p",null,"粘贴、验证、格式化和压缩 JSON 数据")],-1)),l("div",fe,[l("button",{class:v(["main-btn",{disabled:!n.value.trim()}]),onClick:X,disabled:!n.value.trim()},e[5]||(e[5]=[l("i",{class:"mdi mdi-code-json"},null,-1),y(" 格式化 ")]),10,he),l("button",{class:v(["main-btn",{disabled:!n.value.trim()}]),onClick:Y,disabled:!n.value.trim()},e[6]||(e[6]=[l("i",{class:"mdi mdi-arrow-collapse-horizontal"},null,-1),y(" 压缩 ")]),10,ge),l("button",{class:v(["main-btn",{disabled:!n.value.trim()}]),onClick:Z,disabled:!n.value.trim()},e[7]||(e[7]=[l("i",{class:"mdi mdi-check-circle-outline"},null,-1),y(" 验证 ")]),10,be),l("button",{class:v(["main-btn",{disabled:!n.value.trim()}]),onClick:ee,disabled:!n.value.trim()},e[8]||(e[8]=[l("i",{class:"mdi mdi-sort-alphabetical-ascending"},null,-1),y(" 排序 ")]),10,ye)]),l("div",Je,[l("div",{class:"input-panel",onDrop:W,onDragover:e[2]||(e[2]=j(()=>{},["prevent"])),onDragenter:e[3]||(e[3]=j(()=>{},["prevent"])),onDragleave:e[4]||(e[4]=j(()=>{},["prevent"]))},[l("div",Oe,[e[12]||(e[12]=l("h3",null,"输入 JSON",-1)),l("div",Se,[l("button",{class:"action-btn",onClick:le,title:"清空输入"},e[9]||(e[9]=[l("i",{class:"mdi mdi-delete-outline"},null,-1),l("span",null,"清空",-1)])),l("button",{class:"action-btn",onClick:se,title:"从剪贴板粘贴"},e[10]||(e[10]=[l("i",{class:"mdi mdi-clipboard-text-outline"},null,-1),l("span",null,"粘贴",-1)])),l("button",{class:"action-btn",onClick:Q,title:"选择文件"},e[11]||(e[11]=[l("i",{class:"mdi mdi-file-upload-outline"},null,-1),l("span",null,"文件",-1)])),l("input",{ref_key:"fileInput",ref:D,type:"file",onChange:G,style:{display:"none"},accept:".json,.txt"},null,544)])]),l("div",Ne,[l("div",ke,[(m(!0),d(U,null,z(L.value,(s,o)=>(m(),d("div",{key:o,class:v(["line-number",{"error-line":u.value===o+1}])},i(o+1),3))),128))]),ce(l("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),placeholder:"请输入 JSON 字符串，或拖拽文件到此处",class:v(["json-input",{"drag-over":N.value,error:h.value}]),onInput:e[1]||(e[1]=(...s)=>B(V)&&B(V)(...s)),ref_key:"jsonTextarea",ref:C},null,34),[[de,n.value]])]),f.value?(m(),d("div",_e,[l("i",{class:v(["mdi",O.value?"mdi-check-circle text-success":"mdi-alert-circle text-error"])},null,2),l("span",null,i(f.value),1),u.value?(m(),d("button",{key:0,class:"error-location-btn",onClick:ae,title:"跳转到错误位置"},[e[13]||(e[13]=l("i",{class:"mdi mdi-crosshairs-gps"},null,-1)),y(" 跳转到第 "+i(u.value)+" 行 ",1)])):J("",!0)])):J("",!0),k.value?(m(),d("div",Ce,[l("span",null,"字符数: "+i(k.value.charCount),1),l("span",null,"行数: "+i(k.value.lineCount),1),l("span",null,"深度: "+i(k.value.maxDepth),1)])):J("",!0)],32),l("div",we,[l("div",Te,[e[15]||(e[15]=l("h3",null,"格式化结果",-1)),l("div",xe,[l("button",{class:"action-btn",onClick:ne,title:"下载 JSON",disabled:!r.value},e[14]||(e[14]=[l("i",{class:"mdi mdi-download-outline"},null,-1),l("span",null,"下载",-1)]),8,je),l("button",{class:"action-btn",onClick:te,title:"复制结果",disabled:!r.value},[l("i",{class:v(["mdi",S.value?"mdi-check":"mdi-content-copy"])},null,2),l("span",null,i(S.value?"已复制":"复制"),1)],8,De)])]),l("div",Le,[l("div",Me,[(m(!0),d(U,null,z(M.value,(s,o)=>(m(),d("div",{key:o,class:"line-number"},i(o+1),1))),128))]),l("pre",{class:"json-output with-line-numbers",innerHTML:H.value},null,8,Ee)]),_.value?(m(),d("div",Ve,[l("span",null,"字符数: "+i(_.value.charCount),1),l("span",null,"行数: "+i(_.value.lineCount),1),l("span",null,"压缩率: "+i(_.value.compressionRatio)+"%",1)])):J("",!0)])]),ue(me,{name:"toast"},{default:ve(()=>[p.value.show?(m(),d("div",Fe,[l("div",{class:v(["toast",p.value.type])},[l("i",{class:v(["mdi",p.value.icon])},null,2),l("span",null,i(p.value.message),1)],2)])):J("",!0)]),_:1})]))}},Ue=re(Re,[["__scopeId","data-v-e87835f1"]]);export{Ue as default};
